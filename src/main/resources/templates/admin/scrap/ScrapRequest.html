<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="@{layout/admin}">
	  
<!-- contents layout:fragment 정의-->
<th:block layout:fragment="customContents">
		<h2>업사이클링 재료 매입 관리</h2>
		<div class="row">

			<div class="col-sm-12">
				<div class="card">
					<div class="card-header">
						<h5>재료 매입 신청서</h5>
					</div>
					<div class="card-body">
						<form id="validation-form123" action="#!" novalidate="novalidate">
							<input type="hidden" id="scrapSaleRequestCode" name="scrapSaleRequestCode" th:value="${scrapSaleRequestDetailList.scrapSaleRequestCode}">
							<div class="row">
								<div class="col-md-6">
									<div class="form-group">
										<label for="exampleInputPassword1">신청자 아이디</label>
										<input type="text" class="form-control" id="userId" readonly="readonly" th:value="${scrapSaleRequestDetailList.memberId}">
									</div>
								</div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="exampleInputPassword1">주소</label>
									<input type="text" class="form-control" id="addr" readonly="readonly" th:value="${scrapSaleRequestDetailList.shippingOutAddr}" >
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="exampleInputPassword1">재료 이름</label>
									<input type="text" class="form-control" id="scrapname" readonly="readonly"  th:value="${scrapSaleRequestDetailList.upcylingMaterialList.materialName}">
								</div>
							</div>
							<!--   <div class="col-md-6">
								<div class="form-group">
									<label for="exampleInputPassword1">상세주소</label>
									<input type="text" class="form-control" id="addr" readonly="readonly" >
								</div>
							</div>-->
							<div class="col-md-6">
								<div class="form-group">
										<label for="exampleInputPassword1">개수</label>
										<input type="text" class="form-control" id="number" readonly="readonly" th:value="${scrapSaleRequestDetailList.scrapRequestAmount}" >
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="exampleInputPassword1">도착주소</label>
									<input type="text" class="form-control" id="lastaddr" readonly="readonly" th:value="${scrapSaleRequestDetailList.shippingOutAddr}" >
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="exampleInputPassword1">승인여부</label>									
									<span class="scrapRequestResultText" th:if="${scrapSaleRequestDetailList.scrapRequestResult eq 1}">Y</span>
									<span class="scrapRequestResultText" th:unless="${scrapSaleRequestDetailList.scrapRequestResult eq 1}">N</span>
									
								</div>
							</div>
							
					<!-- 	<div class="col-md-6">
								<div class="form-group">
									<label class="form-label">사진 업로드</label>
									<div>
										<input type="file" class="validation-file" name="imgfile" readonly="readonly" >
									</div>
								</div>
							</div> -->
							
						<!--  <div class="col-md-6">
								<div class="form-group">
									<label for="exampleInputPassword1">운송장번호</label>
									<input type="text" class="form-control" id="number" readonly="readonly" >
								</div>
							</div>-->
							<div class="col-md-12">								
							 	<button th:if="${scrapSaleRequestDetailList.scrapRequestResult eq 1}" th:value="${scrapSaleRequestDetailList.scrapRequestResult}" class="btn btn-danger approval-action" type="button">승인 취소</button>
								<button th:unless="${scrapSaleRequestDetailList.scrapRequestResult eq 1}" th:value="${scrapSaleRequestDetailList.scrapRequestResult}" class="btn btn-primary approval-action" type="button">승인</button>
							</div>
					 			<a th:href="@{/admin/scrap/ListManage}" class="btn btn-success" >목록</a>
						</div>
						</form>
					</div>
				</div>
			</div>
		<script type="text/javascript">
		$(function(){
			$('.approval-action').click(function(){
				var bnt = $(this); 
				var scrapSaleRequestCode = $('#scrapSaleRequestCode').val();
				var scrapRequestResultTextSpan = $('.scrapRequestResultText');
				var scrapRequestResult = Number($(this).val());
				//상태값 반대로 변경
				var modifyScrapRequestResult = 0;
				if(scrapRequestResult == 0){
					modifyScrapRequestResult = 1;
				}else{
					modifyScrapRequestResult = 0;						
				}
				
				var request = $.ajax({
					url: "/admin/scrap/ScrapRequestApprovalAjax",
					method: "POST",
					data: { scrapSaleRequestCode: scrapSaleRequestCode, scrapRequestResult : modifyScrapRequestResult },
					dataType: "json"
				});
				 
				request.done(function( data ) {
					var result = data.result;
					if(result > 0){
						if(scrapRequestResult == 0){	
							bnt.addClass('btn-danger').removeClass('btn-primary');
							bnt.text('승인 취소');
							bnt.val(1);
							scrapRequestResultTextSpan.text('Y');
						}else{
							bnt.addClass('btn-primary').removeClass('btn-danger');
							bnt.text('승인');				
							bnt.val(0);
							scrapRequestResultTextSpan.text('N');
						}	
					}else{
						if(scrapRequestResult == 0){								
							alert('승인 변경에 실패 하였습니다.');	
						}else{
							alert('승인취소 변경에 실패 하였습니다.');									
						}								
					}
					
				});
				 
				request.fail(function( jqXHR, textStatus ) {
					alert( "Request failed: " + textStatus );
				});
			});
		});
		</script>
		</div>
		
</th:block>

</html>
