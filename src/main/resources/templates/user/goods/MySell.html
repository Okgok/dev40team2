<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="@{layout/user}">

<th:block layout:fragment="customTitle">
	<title th:text="${title}"></title>
</th:block>

<th:block layout:fragment="userCustomContents">

	<div class="card-header" style = "background-color: cornflowerblue; width: 1000px; margin-top: 30px; float: left">
		<h3 th:text="${h1text}" style = "color: white;"></h3>
	</div>
	<div class="card-body" style = "background-color: white; width: 1000px; float: left">
		<form th:action="@{/goodsSellerRequest}" method="get">
			<div class="card text-white bg-success ">
				<div class="card-body">
					<h5 class="card-title text-white">위탁 판매 주의 사항을 확인해주세요</h5>
					<p class="card-text">1. 위탁 판매 등록할 수 있는 최대 상품의 개수는 10개입니다.</p>
					<p class="card-text">2. 판매 신청이 등록되면 관리자가 신청 확인 후 2-3일 이내에 승인 여부를 알려드립니다.</p>
					<p class="card-text">3. 승인 후 7일 이내에 배송을 완료하지 않으시면 자동 취소됩니다.</p>
					<p class="card-text">4. 신청 내용과 다른 내용의 상품이 배송된 경우 수취인 부담 반송처리됩니다.</p>
				</div>
			</div>
			<ol class="breadcrumb">
				<div>고객님의 아이디는</div>
				<!--세션에서 받아온 아이디를 readonly로 받아오는 코드 필요-->
				<input type="text" class="form-control" placeholder="upbus_user" id="goodSellerId" name="goodsSellerId" readonly="readonly">
			</ol>
			<ol class="breadcrumb">
				<div>상품의 이름을 정해주세요. 부적절한 경우 신청이 접수되지 않을 수 있어요.</div>
				<input type="text" class="form-control" placeholder="상품의 이름" name="goodsRequestName"/>
			</ol>
			<ol class="breadcrumb">
				<div>상품의 종류가 어떻게 분류되는지 선택해주세요.</div>
				<div class="form-group">
					1. 먼저 큰 분류를 선택해주세요.
					<select class="form-control" id="goodsMainCategory" onchange="chainedSub(this.value)">
						<option>큰 분류</option>
						<option th:each="list : ${goodsCategoryMainList}" th:value="${list.goodsCategoryMainName}">[[${list.goodsCategoryMainName}]]</option>
					</select>
				</div>
				<div class="form-group">
					2. 다음 작은 분류를 선택해주세요.
					<select class="form-control" id="goodsSubCategory">
						<option value="">작은 분류</option>
					</select>
				</div>
			</ol>
			<script>
				//메인 카테고리가 선택된 후 각각의 메인 카테고리에 맞는 서브 카테고리를 select option에 표시하기
				var goodsSubCategory = $('#goodsSubCategory');
				//이 클릭 이벤트는 왜 걸리지 않을까?
				goodsSubCategory.click(function () {
					if ($('#goodsMainCategory').val() == '큰 분류') {
						alert("메인 카테고리를 먼저 선택해주세요.");
						$('#goodsMainCategory').focus();
						return;
					}
				});
				function chainedSub(main) {
					/*goodsSubCategory.empty();*/
					if(main == ''){
						goodsSubCategory.append('<option value="">작은 분류</option>');
					}
					$.ajax({
						url: 'user/goods/MySell/GetSubCategory',
						data: {goodsMainCategory: $('#goodsMainCategory option:selected').val()},
						dataType: "json",
						type: 'get',
						success: function (data) {
							$('#goodsSubCategory option').remove();
							if(data.length == 0){
								goodsSubCategory.append('<option value="">작은 분류</option>');
							}else {
								$(data).each(function (i) {
									goodsSubCategory.append('<option value="' + data[i].goodsCategorySubName + '">'
											+ data[i].goodsCategorySubName + '</option>');
								});
							}
						},
						error: function () {
							alert("Bad Request");
						}
					});
				}
			</script>

			<ol class="breadcrumb">
				<div>가격을 정할 때 도움을 드리기 위해서 지정된 카테고리의 상품들이 지금 얼마인지 보여드릴게요.</div>
				<div class="row">
					<div class="card col-sm-4">
						<img class="img-fluid card-img-top" src="../static/images/test1.jpg" alt="Card image cap">
						<div class="card-body">
							<h5 class="card-title">업체 전문 상품 예시</h5>
							<p class="card-text">가격 표시 영역</p>
							<p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
						</div>
					</div>
					<div class="card col-sm-4">
						<img class="img-fluid card-img-top" src="../static/images/test2.jpg" alt="Card image cap">
						<div class="card-body">
							<h5 class="card-title">판매 위탁 상품 예시 1</h5>
							<p class="card-text">가격 표시 영역</p>
							<p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
						</div>
					</div>
					<div class="card col-sm-4">
						<img class="img-fluid card-img-top" src="../static/images/test3.jpg" alt="Card image cap">
						<div class="card-body">
							<h5 class="card-title">판매 위탁 상품 예시 2</h5>
							<p class="card-text">가격 표시 영역</p>
							<p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
						</div>
					</div>
				</div>
			</ol>
			<ol class="breadcrumb">
				<div>상품의 가격을 정해주세요. 업버스에서 판매중인 유사한 상품의 가격을 참고하세요.</div>
				<div>상품이 1년동안 판매되지 않으면 취소되고 다시 판매할 수 없으니 주의해주세요.</div>
				<input type="number" class="form-control" placeholder="상품의 가격" name="goodsRequestPrice"/>
			</ol>
			<div class="check_font" id="amountCheckText"></div>
			<ol class="breadcrumb">
				<div style>판매하려는 상품의 개수를 적어주세요.</div>
				<div style="color : red;"> 판매중인 업사이클링 상품을 10개를 초과하여 판매할 수 없어요.</div>
				<div class="input-group mb-3">
					<input type="number" class="form-control" placeholder="상품의 개수" id="goodsRequestAmount" name="goodsRequestAmount" aria-label="Recipient's username" aria-describedby="basic-addon2">
				</div>
			</ol>

			<script>
				//회원이 판매중인 상품이 10개가 넘는지 확인하고 비동기식으로 표시하기
				$(function() {
					var goodsRequestAmount = $('#goodsRequestAmount');
					var amountCheckText = $('#amountCheckText');
					var goodsSellerId = $('#goodSellerId');
					goodsRequestAmount.blur(function () {

						if (goodsRequestAmount.val() == 0) {
							amountCheckText.text("판매할 개수를 정확하게 입력해주세요.");
							amountCheckText.css("color", "red");
							return;
						}

						$.ajax({
							url: 'user/goods/MySell',
							data: {goodsRequestAmount: goodsRequestAmount.val(), goodsSellerId: goodsSellerId.val()},
							dataType: "json",
							type: 'get',
							success: function (data) {
								if (data <= 10) {
									//현재 판매 중인 상품의 개수와, 입력한 개수의 합이 10이하인 경우
									amountCheckText.text("판매할 수 있습니다.");
									amountCheckText.css("color", "blue");
									$('#goodsRequestSubmit').attr("disabled", false);

								} else if (data > 10) {
									amountCheckText.text("총 판매 상품이 10개가 초과되므로 판매할 수 없습니다.");
									amountCheckText.css("color", "red");
									$('#goodsRequestSubmit').attr("disabled", true);
								}

							},
							error: function (jqXHR, textStatus) {
								goodsRequestAmount.focus();
								amountCheckText.text("유효하지 않은 개수가 입력되었습니다. 다시 입력해주세요.");
								amountCheckText.css("color", "purple");
							}
						});
					});
				});

			</script>

			<ol class="breadcrumb">
				<div>상품에 대해서 간략하게 알려주세요.</div>
				<input type="text" class="form-control" placeholder="상품의 상세 설명" name="goodsRequestDesc"/>
			</ol>
			<div class="card-body" style="background: #EFF3F6;">
				<form action="../assets/plugins/fileupload/js/file-upload.php" class="dropzone dz-clickable">
					<div class="dz-default dz-message"><span>상품이 어떤 모습인지 보여주세요.
            사진 파일을 여기에 드래그하세요.</span></div></form>
				<div class="text-center m-t-20">
					<button type="submit" class="btn btn-primary" name="goodsRequestImage">파일 업로드 확인</button>
				</div>
			</div>
			<div>
			</div>
			<ol class ="row">
				<button type="submit" class="btn btn-success offset-10" id="goodsRequestSubmit" data-toggle="tooltip" data-original-title="btn btn-success">위탁 신청하기</button>
			</ol>
		</form>
</th:block>
</html>