<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="thedrivers.upbus.mapper.GoodsMapper">

    <resultMap id="goodsCategoryMain" type="GoodsCategoryMain">
        <result property="goodsCategoryMainCode"		column="goods_category_main_code"></result>
        <result property="goodsCategoryMainName"		column="goods_category_main_name"></result>
    </resultMap>

    <resultMap id="goodsCategorySub" type="GoodsCategorySub">
        <result property="goodsCategorySubCode"		column="goods_category_sub_code"></result>
        <result property="goodsCategorySubName"		column="goods_category_sub_name"></result>
    </resultMap>

    <select id="getGoodsCategoryMainList" resultMap="goodsCategoryMain">
        SELECT
            goods_category_main_name
        FROM
             goods_category_main;
    </select>

    <select id="getGoodsCategorySubList" resultMap="goodsCategorySub">
        SELECT
            goods_category_sub_name
        FROM
            goods_category_sub as sub
        INNER JOIN
            goods_category_main as main
        ON
            sub.goods_category_main_code = main.goods_category_main_code
        WHERE
            main.goods_category_main_name=#{goodsMainCategory};
    </select>

    <select id="getGoodsRequestAmount" parameterType="String" resultType="int">
        SELECT
            COUNT(req.member_id)
        FROM
            goods_inventory as inv
        INNER JOIN
            goods_request as req
        ON
            inv.goods_request_code = req.goods_request_code
        WHERE
              req.member_id=#{memberId};
    </select>

    <insert id="goodsRequest" parameterType="GoodsRequest">
        INSERT INTO goods_request
        (member_id,
         goods_request_name,
         goods_category_sub_code,
         goods_request_price,
         goods_request_amount,
         goods_request_image,
         goods_request_desc,
         goods_request_date,
         goods_request_approval
        )VALUES (
        #{goodsSellerId},
        #{goodsRequestName},
        #{goodsCategorySubCode},
        #{goodsRequestPrice},
        #{goodsRequestAmount},
        #{goodsRequestImage},
        #{goodsRequestDesc},
        CURDATE(),
        false
        );
    </insert>

</mapper>